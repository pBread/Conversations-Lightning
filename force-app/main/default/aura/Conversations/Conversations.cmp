<aura:component
  controller="TwilioConversationApi"
  implements="flexipage:availableForRecordHome, force:hasRecordId"
>
  <!-- Fetch Record -->
  <aura:attribute name="record" type="Object" />
  <aura:attribute name="recordError" type="String" />
  <force:recordData
    aura:id="recordLoader"
    fields="Name,MobilePhone"
    recordId="{!v.recordId}"
    targetFields="{!v.record}"
    targetError="{!v.recordError}"
    recordUpdated="{!c.handleRecordUpdated}"
  />
  <aura:if isTrue="{!not(empty(v.recordError))}">
    <div class="recordError">{!v.recordError}</div>
  </aura:if>

  <!-- Other Attributes -->
  <aura:attribute default="[]" name="conversationSids" type="String[]" />
  <aura:attribute name="credential" type="Twilio_Credentials__c" />

  <!-- UI -->
  <div class="c-header">
    <img height="50" width="50" src="{!$Resource.twilio_logo}" />
  </div>

  <aura:iteration
    items="{!v.conversationSids}"
    var="conversationSid"
    indexVar="key"
  >
    <c:ConversationContainer
      conversationSid="{!conversationSid}"
      credential="{!v.credential}"
      record="{!v.record}"
    />
  </aura:iteration>
</aura:component>
