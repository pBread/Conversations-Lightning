<aura:component
  controller="TwilioConversationApi"
  implements="flexipage:availableForRecordHome, force:hasRecordId"
>
  <!-- Contact Record -->
  <aura:attribute name="record" type="Object" />
  <aura:attribute name="recordError" type="String" />
  <force:recordData
    aura:id="recordLoader"
    fields="Name,MobilePhone"
    recordId="{!v.recordId}"
    recordUpdated="{!c.onRecordLoaded}"
    targetError="{!v.recordError}"
    targetFields="{!v.record}"
  />
  <aura:if isTrue="{!not(empty(v.recordError))}">
    <div class="recordError">{!v.recordError}</div>
  </aura:if>

  <!-- Credentials -->
  <aura:attribute
    access="private"
    default="[]"
    description="Credential recordIds"
    name="credentialIds"
    type="String[]"
  />

  <!-- Conversations -->
  <aura:attribute
    access="private"
    default="[]"
    description="All conversations mapped to this Contact's phone number"
    name="convoSids"
    type="String[]"
  />

  <!-- Maps -->
  <aura:attribute
    access="private"
    default="{}"
    description="Map conversationSid => credential"
    name="convoToCredential"
    type="Map"
  />
  <aura:attribute
    access="public"
    default="{}"
    description="Map conversationSid => messages"
    name="convoToMessages"
    type="Map"
  />
  <aura:attribute
    access="public"
    default="{}"
    description="Map conversationSid => participant"
    name="convoToParticipants"
    type="Map"
  />

  <!-- UI -->
  <div class="c-header">
    <img height="50" width="50" src="{!$Resource.twilio_logo}" />
  </div>

  <lightning:button label="Tester" onclick="{!c.tester}" />
</aura:component>
